# üìã –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è AI Translator & Critic

–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö unit-—Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## üìñ –û–±–∑–æ—Ä

**–§–∞–π–ª:** `tests/unit/test_app.py`  
**–§—Ä–µ–π–º–≤–æ—Ä–∫:** pytest  
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:** 4  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º API –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

–≠—Ç–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ñ—É–Ω–∫—Ü–∏—é `call_llm()` –∏–∑ `src/app.py`:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ API (200 OK)
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –æ—à–∏–±–æ–∫ (4xx/5xx)

**–í–∞–∂–Ω–æ:** –í—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ú–û–ö–ò (mocks), –ø–æ—ç—Ç–æ–º—É:
- ‚ùå –ù–ï –¥–µ–ª–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API
- ‚ùå –ù–ï —Ç—Ä–∞—Ç—è—Ç —Ç–æ–∫–µ–Ω—ã
- ‚úÖ –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ (<1 —Å–µ–∫—É–Ω–¥–∞)

---

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ 4 —Ç–µ—Å—Ç–∞:
pytest tests/unit/test_app.py -v


**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
tests/unit/test_app.py::test_positive_call_llm_returns_text PASSED
tests/unit/test_app.py::test_environment_key_loading PASSED
tests/unit/test_app.py::test_error_handling_on_request_exception PASSED
tests/unit/test_app.py::test_handling_http_error_response PASSED

========== 4 passed in 0.56s ==========

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç:
pytest tests/unit/test_app.py::test_positive_call_llm_returns_text -v


### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º:
pytest tests/unit/test_app.py -vv


---

## üìù –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### 1. test_positive_call_llm_returns_text

**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** Positive Test (—É—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

#### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:
–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `call_llm()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –æ—Ç–≤–µ—Ç–µ API (200 OK).

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ—Å—Ç:

1. **Setup (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞):**
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π API –∫–ª—é—á
app = reload_app_module(monkeypatch, env_value="DUMMY_KEY")

–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –º–æ–∫-–æ—Ç–≤–µ—Ç
mocked_json = {"response": "Mocked translation text"}
mock_response = make_mock_response(status=200, json_data=mocked_json)

2. **Action (–¥–µ–π—Å—Ç–≤–∏–µ):**
–ú–æ–∫–∏—Ä—É–µ–º requests.post
with patch("requests.post", return_value=mock_response):
result = app.call_llm("Qwen/Qwen3-VL-30B-A3B-Instruct", ["–¢–µ–∫—Å—Ç"])

3. **Assert (–ø—Ä–æ–≤–µ—Ä–∫–∞):**
–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–∂–∏–¥–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
assert "Mocked translation text" in result

–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ requests.post –±—ã–ª –≤—ã–∑–≤–∞–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é
assert call_kwargs['json']['model_name'] == "Qwen/Qwen3-VL-30B-A3B-Instruct"


#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ –ø–æ–ª—è `response`
- ‚úÖ API –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç

#### –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ü–ê–î–ï–ù–ò–ï —Ç–µ—Å—Ç–∞:
üö® –§—É–Ω–∫—Ü–∏—è `call_llm()` –Ω–µ –º–æ–∂–µ—Ç –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ API.  
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ò–∑–º–µ–Ω–∏–ª—Å—è —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API
- –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ —Ñ—É–Ω–∫—Ü–∏–∏ `call_llm()`

---

### 2. test_environment_key_loading

**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** Environment Test (–∑–∞–≥—Ä—É–∑–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

#### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:
–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `MENTORPIECE_API_KEY`.

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ—Å—Ç:

1. **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ö–ª—é—á –∑–∞–¥–∞–Ω**
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª—é—á –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
app = reload_app_module(monkeypatch, env_value="SOME_KEY")

–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∑–∏–ª –µ–≥–æ
assert hasattr(app, "MENTORPIECE_API_KEY")
assert app.MENTORPIECE_API_KEY == "SOME_KEY"

2. **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö–ª—é—á –ù–ï –∑–∞–¥–∞–Ω**
–£–¥–∞–ª—è–µ–º –∫–ª—é—á –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è
app2 = reload_app_module(monkeypatch, env_value=None)

–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ None
assert app2.MENTORPIECE_API_KEY is None


#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ï—Å–ª–∏ –∫–ª—é—á –∑–∞–¥–∞–Ω ‚Üí `MENTORPIECE_API_KEY == "SOME_KEY"`
- ‚úÖ –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ –∑–∞–¥–∞–Ω ‚Üí `MENTORPIECE_API_KEY is None`
- ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç

#### –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ü–ê–î–ï–ù–ò–ï —Ç–µ—Å—Ç–∞:
üö® –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.  
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- `load_dotenv()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- `os.getenv()` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- –ü—Ä–æ–±–ª–µ–º–∞ —Å `.env` —Ñ–∞–π–ª–æ–º

---

### 3. test_error_handling_on_request_exception

**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** Error Handling (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

#### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:
–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `call_llm()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–π–º–∞—É—Ç, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞).

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ—Å—Ç:

1. **Setup (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞):**
app = reload_app_module(monkeypatch, env_value="DUMMY_KEY")

–ú–æ–∫–∏—Ä—É–µ–º requests.post, —á—Ç–æ–±—ã –æ–Ω –≤—ã–±—Ä–∞—Å—ã–≤–∞–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
def raise_request(*args, **kwargs):
raise requests.RequestException("Connection failed")

2. **Action + Assert:**
with patch("requests.post", side_effect=raise_request):
result = app.call_llm("Qwen/...", ["–¢–µ–∫—Å—Ç"])

   # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –ù–ï —É–ø–∞–ª–∞, –∞ –≤–µ—Ä–Ω—É–ª–∞ —Å—Ç—Ä–æ–∫—É —Å –æ—à–∏–±–∫–æ–π
   assert isinstance(result, str)
   assert "–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞" in result or "Connection failed" in result

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –ù–ï –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞—Ä—É–∂—É
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞]`
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç

#### –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ü–ê–î–ï–ù–ò–ï —Ç–µ—Å—Ç–∞:
üö® –§—É–Ω–∫—Ü–∏—è –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø–∞–¥–∞–µ—Ç.  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç 500 Internal Server Error

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `try/except requests.RequestException` –≤ `call_llm()`

---

### 4. test_handling_http_error_response

**–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** Error Handling (–æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –æ—à–∏–±–æ–∫)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

#### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:
–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `call_llm()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP –æ—à–∏–±–∫–∏ –æ—Ç API (4xx, 5xx).

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ—Å—Ç:

1. **Setup (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞):**
app = reload_app_module(monkeypatch, env_value="DUMMY_KEY")

–ú–æ–∫–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–æ–π 500
mock_response = make_mock_response(
status=500,
json_data={"error": "Server error"}
)

2. **Action + Assert:**
with patch("requests.post", return_value=mock_response):
result = app.call_llm("claude-sonnet-4-5-20250929", ["–¢–µ–∫—Å—Ç"])

   # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ
   assert "–û—à–∏–±–∫–∞ API" in result or "500" in result

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—à–∏–±–∫–µ
- ‚úÖ –í —Å—Ç—Ä–æ–∫–µ —É–∫–∞–∑–∞–Ω HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥ (500)
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–∞–¥–∞–µ—Ç
- ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç

#### –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ü–ê–î–ï–ù–ò–ï —Ç–µ—Å—Ç–∞:
üö® –§—É–Ω–∫—Ü–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∫–∞–∫ —É—Å–ø–µ—Ö.  
**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏
- –°–ª–æ–∂–Ω–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å API

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `if not response.ok:` –≤ `call_llm()`

---

## üîß –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### reload_app_module()
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å `app` —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

**–ü–æ—á–µ–º—É —ç—Ç–æ –Ω—É–∂–Ω–æ:**  
Python –∫—ç—à–∏—Ä—É–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏. –ß—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `MENTORPIECE_API_KEY`, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å.

def reload_app_module(monkeypatch, env_value):
# –£–¥–∞–ª—è–µ–º –º–æ–¥—É–ª—å –∏–∑ –∫—ç—à–∞
if 'app' in sys.modules:
del sys.modules['app']

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
if env_value is not None:
    monkeypatch.setenv('MENTORPIECE_API_KEY', env_value)
else:
    monkeypatch.delenv('MENTORPIECE_API_KEY', raising=False)

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å –∑–∞–Ω–æ–≤–æ
import app
importlib.reload(app)
return app


### make_mock_response()
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –º–æ–∫-–æ–±—ä–µ–∫—Ç `requests.Response`.

def make_mock_response(status, json_data=None):
mock_resp = Mock()
mock_resp.status_code = status
mock_resp.ok = (200 <= status < 300)

if json_data is not None:
    mock_resp.json.return_value = json_data
else:
    mock_resp.json.side_effect = ValueError("No JSON")

return mock_resp

---

## üìä –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ (4 passed)
========== 4 passed in 0.56s ==========

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `call_llm()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ API –∑–∞–ø—Ä–æ—Å—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–î–µ–π—Å—Ç–≤–∏—è:** –ù–µ—Ç. –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

### ‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã —É–ø–∞–ª–∏ (FAILED)

#### –ü—Ä–∏–º–µ—Ä:
FAILED tests/unit/test_app.py::test_positive_call_llm_returns_text
========== 1 failed, 3 passed in 0.56s ==========


**–®–∞–≥–∏ –æ—Ç–ª–∞–¥–∫–∏:**

1. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:**
pytest tests/unit/test_app.py::test_positive_call_llm_returns_text -vv

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ `call_llm()`** –≤ `src/app.py`

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–æ–∫:**
–í —Ç–µ—Å—Ç–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
with patch("requests.post", return_value=mock_response):

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è:
from src.app import call_llm
result = call_llm("Qwen/...", [{"role": "user", "content": "Test"}])
print(result)

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
1. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º:**
pytest tests/unit/test_app.py -q


2. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã** –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –≤ `call_llm()`

3. **–ù–µ —É–¥–∞–ª—è–π—Ç–µ –º–æ–∫–∏** ‚Äî –æ–Ω–∏ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç —Ç—Ä–∞—Ç —Ç–æ–∫–µ–Ω–æ–≤

### –î–ª—è QA:
1. **–ò–∑—É—á–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** –≤ `tests/unit/test_app.py` ‚Äî —Ç–∞–º –ø–æ–¥—Ä–æ–±–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è

2. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Å —Ñ–ª–∞–≥–æ–º `-vv`** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞:

pytest tests/unit/test_app.py -vv

3. **–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞** ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤" –≤—ã—à–µ

---

## üîó –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –î–æ–∫—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|---------|
| `TESTS_README.md` | –û–±–∑–æ—Ä –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ |
| `SECURITY_TESTS_README.md` | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è security —Ç–µ—Å—Ç–æ–≤ (11 —Ç–µ—Å—Ç–æ–≤) |
| `README_CYPRESS.md` | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è UI-—Ç–µ—Å—Ç–æ–≤ (Cypress) |

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **pytest Documentation:** https://docs.pytest.org
- **unittest.mock Guide:** https://docs.python.org/3/library/unittest.mock.html
- **Monkeypatch Fixture:** https://docs.pytest.org/en/stable/how-to/monkeypatch.html

---

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

- [ ] –í—Å–µ 4 —Ç–µ—Å—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç: `pytest tests/unit/test_app.py -q`
- [ ] –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫–∏)
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã
- [ ] –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∫—Ä—ã—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –î–µ–∫–∞–±—Ä—å 2025*