/**
 * –®–ê–ë–õ–û–ù –î–õ–Ø –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ù–û–í–´–• –¢–ï–°–¢–û–í
 * 
 * –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –∫–∞–∫ —à–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö E2E —Ç–µ—Å—Ç–æ–≤
 * –≤ `cypress/e2e/translator_critic.cy.js`
 */

// ============================================================
// –ü–†–ò–ú–ï–† 1: –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
// ============================================================

describe('–ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã', () => {
  const API_ENDPOINT = 'https://api.mentorpiece.org/v1/process-ai-request'

  beforeEach(() => {
    cy.visit('/')
  })

  it('–û–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞', () => {
    /**
     * STEP 1: SETUP (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è)
     * –û–ø–∏—Å–∞–Ω–∏–µ: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç API –∑–∞–ø—Ä–æ—Å–æ–≤
     */
    cy.intercept('POST', API_ENDPOINT, (req) => {
      // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
      if (req.body.model_name === '–≤–∞—à–∞-–º–æ–¥–µ–ª—å') {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
        req.reply({
          statusCode: 200,
          body: { response: '–í–∞—à –æ—Ç–≤–µ—Ç' }
        })
        return
      }
      req.continue()
    }).as('yourRequest')

    /**
     * STEP 2: ACTION (–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
     * –û–ø–∏—Å–∞–Ω–∏–µ: –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
     */
    cy.get('#original_text')
      .clear()
      .type('–í–∞—à —Ç–µ–∫—Å—Ç')

    cy.get('#target_lang')
      .select('English')

    cy.contains('button', '–ü–µ—Ä–µ–≤–µ—Å—Ç–∏')
      .click()

    /**
     * STEP 3: WAIT (–û–∂–∏–¥–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)
     * –û–ø–∏—Å–∞–Ω–∏–µ: –ñ–¥—ë–º –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
     */
    cy.wait('@yourRequest').then((interception) => {
      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
      expect(interception.request.body).to.have.property('model_name')
    })

    /**
     * STEP 4: ASSERT (–ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
     * –û–ø–∏—Å–∞–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
     */
    cy.contains('–í–∞—à –æ—Ç–≤–µ—Ç')
      .should('be.visible')
  })
})

// ============================================================
// –ü–†–ò–ú–ï–† 2: –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
// ============================================================

describe('–¢–µ—Å—Ç—ã –æ—à–∏–±–æ–∫ - —à–∞–±–ª–æ–Ω', () => {
  const API_ENDPOINT = 'https://api.mentorpiece.org/v1/process-ai-request'

  beforeEach(() => {
    cy.visit('/')
  })

  it('–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏', () => {
    /**
     * –ú–æ–∫–∏—Ä—É–µ–º 500 –æ—à–∏–±–∫—É
     */
    cy.intercept('POST', API_ENDPOINT, {
      statusCode: 500,
      body: { error: 'Server Error' }
    }).as('apiError')

    // –í—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
    cy.get('#original_text').type('–¢–µ–∫—Å—Ç')
    cy.get('#target_lang').select('English')
    cy.contains('button', '–ü–µ—Ä–µ–≤–µ—Å—Ç–∏').click()

    // –ñ–¥—ë–º –æ—à–∏–±–∫—É
    cy.wait('@apiError')

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏
    cy.get('body').should('contain', '–û—à–∏–±–∫–∞')
  })
})

// ============================================================
// –ü–†–ò–ú–ï–† 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Ç–µ—Å—Ç —Å —É—Å–ª–æ–≤–Ω—ã–º –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º
// ============================================================

describe('–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Å—Ç—ã - —à–∞–±–ª–æ–Ω', () => {
  const API_ENDPOINT = 'https://api.mentorpiece.org/v1/process-ai-request'

  beforeEach(() => {
    cy.visit('/')
  })

  it('–¢–µ—Å—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ –º–æ–∫–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π', () => {
    /**
     * –°–ª–æ–∂–Ω–æ–µ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
     */
    let callCount = 0

    cy.intercept('POST', API_ENDPOINT, (req) => {
      callCount++
      console.log(`API Call #${callCount}`)

      if (req.body.model_name === 'model-1') {
        req.reply({
          statusCode: 200,
          body: { response: 'Response for model 1' },
          delay: 500  // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏
        })
        return
      }

      if (req.body.model_name === 'model-2') {
        req.reply({
          statusCode: 200,
          body: { response: 'Response for model 2' }
        })
        return
      }

      req.continue()
    }).as('apiCall')

    // –í–∞—à —Ç–µ—Å—Ç –∑–¥–µ—Å—å
  })
})

// ============================================================
// –ü–†–ò–ú–ï–† 4: –¢–µ—Å—Ç UI —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —ç–ª–µ–º–µ–Ω—Ç–æ–≤
// ============================================================

describe('UI —Ç–µ—Å—Ç—ã - —à–∞–±–ª–æ–Ω', () => {
  beforeEach(() => {
    cy.visit('/')
  })

  it('–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤', () => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    cy.get('#original_text').should('be.visible')
    cy.get('#target_lang').should('be.visible')
    cy.contains('button', '–ü–µ—Ä–µ–≤–µ—Å—Ç–∏').should('be.visible')

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
    cy.get('#original_text')
      .type('–¢–µ–∫—Å—Ç')
      .should('have.value', '–¢–µ–∫—Å—Ç')

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º select
    cy.get('#target_lang').select('French')
    cy.get('#target_lang').should('have.value', 'French')

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–∫—Å—Ç –æ—Å—Ç–∞–ª—Å—è
    cy.get('#original_text').should('have.value', '–¢–µ–∫—Å—Ç')
  })
})

// ============================================================
// –ü–†–ê–í–ò–õ–ê –ò BEST PRACTICES
// ============================================================

/**
 * ‚úÖ –î–ï–õ–ê–ô–¢–ï –¢–ê–ö:
 * 
 * 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ cy.wait() –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å API
 *    cy.wait('@apiRequest')
 * 
 * 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ cy.intercept() –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è
 *    cy.intercept('POST', url, mock)
 * 
 * 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ cy.contains() –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
 *    cy.contains('button', 'Text')
 * 
 * 4. –î–æ–±–∞–≤–ª—è–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
 *    // STEP 1: SETUP, // STEP 2: ACTION, etc.
 * 
 * 5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ alias –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–æ–≤
 *    .as('myRequest')
 * 
 * 6. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ then() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ—Ç–∞–ª–µ–π
 *    .then((interception) => { expect(...) })
 */

/**
 * ‚ùå –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö:
 * 
 * 1. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ cy.wait(1000) –¥–ª—è –∑–∞–¥–µ—Ä–∂–µ–∫
 *    ‚ùå cy.wait(1000)
 *    ‚úÖ cy.wait('@request')
 * 
 * 2. –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
 *    ‚ùå cy.request('POST', 'https://api.com/...')
 *    ‚úÖ cy.intercept(..., mock)
 * 
 * 3. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∂—ë—Å—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã
 *    ‚ùå cy.get('#elem', { timeout: 30000 })
 *    ‚úÖ cy.get('#elem')  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π 4 —Å–µ–∫
 * 
 * 4. –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
 *    ‚ùå cy.get('#text').type('value')
 *    ‚úÖ // –í–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ
 *       cy.get('#text').type('value')
 * 
 * 5. –ù–µ –¥–µ–ª–∞–π—Ç–µ –∑–∞–≤–∏—Å–∏–º—ã–µ —Ç–µ—Å—Ç—ã
 *    ‚ùå it('Test A') { ... }
 *       it('Test B - depends on A') { ... }
 *    ‚úÖ –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
 */

/**
 * –ü–û–õ–ï–ó–ù–´–ï –§–£–ù–ö–¶–ò–ò:
 * 
 * cy.visit(url)              // –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
 * cy.get(selector)           // –ù–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç
 * cy.contains(text)          // –ù–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –ø–æ —Ç–µ–∫—Å—Ç—É
 * cy.intercept(method, url, handler)  // –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∑–∞–ø—Ä–æ—Å
 * cy.wait(alias)             // –ñ–¥–∞—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
 * cy.type(text)              // –í–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç
 * cy.select(option)          // –í—ã–±—Ä–∞—Ç—å –æ–ø—Ü–∏—é
 * cy.click()                 // –ö–ª–∏–∫–Ω—É—Ç—å
 * .should(assertion)         // –ü—Ä–æ–≤–µ—Ä–∫–∞
 * .then(callback)            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
 */

/**
 * –ü–û–õ–ï–ó–ù–´–ï ASSERTIONS:
 * 
 * .should('be.visible')      // –í–∏–¥–∏–º–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–∞
 * .should('be.enabled')      // –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
 * .should('exist')           // –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
 * .should('have.value', 'text')  // –ó–Ω–∞—á–µ–Ω–∏–µ
 * .should('contain', 'text') // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ
 * .should('be.empty')        // –ü—É—Å—Ç–æ
 * .should('have.length', 5)  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
 */

/**
 * –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´ –î–õ–Ø –û–¢–õ–ê–î–ö–ò:
 * 
 * // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
 * console.log('Message', variable)
 * 
 * // –ü–∞—É–∑–∞ –¥–ª—è –∏–Ω—Å–ø–µ–∫—Ü–∏–∏
 * cy.debug()
 * 
 * // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
 * .then((interception) => {
 *   console.log('Request:', interception.request.body)
 *   console.log('Response:', interception.response.body)
 * })
 */

// ============================================================
// –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–°–£–†–°–´
// ============================================================

/**
 * üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
 * - docs/CYPRESS_QUICK_START.md
 * - docs/CYPRESS_SETUP.md
 * - docs/ARCHITECTURE_AND_DESIGN.md
 * 
 * üîó –°—Å—ã–ª–∫–∏:
 * - https://docs.cypress.io
 * - https://docs.cypress.io/api/commands/intercept
 * - https://docs.cypress.io/guides/references/best-practices
 */

// ============================================================
// –ì–û–¢–û–í–´–ô –®–ê–ë–õ–û–ù –î–õ–Ø –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø
// ============================================================

/*
describe('–ú–æ–π –Ω–æ–≤—ã–π —Ç–µ—Å—Ç', () => {
  const API_ENDPOINT = 'https://api.mentorpiece.org/v1/process-ai-request'

  beforeEach(() => {
    cy.visit('/')
  })

  it('–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞', () => {
    // STEP 1: SETUP
    cy.intercept('POST', API_ENDPOINT, (req) => {
      if (req.body.model_name === 'your-model') {
        req.reply({
          statusCode: 200,
          body: { response: 'Your response' }
        })
        return
      }
      req.continue()
    }).as('yourRequest')

    // STEP 2: ACTION
    cy.get('#original_text').clear().type('Your text')
    cy.get('#target_lang').select('English')
    cy.contains('button', '–ü–µ—Ä–µ–≤–µ—Å—Ç–∏').click()

    // STEP 3: WAIT
    cy.wait('@yourRequest')

    // STEP 4: ASSERT
    cy.contains('Your response').should('be.visible')
  })
})
*/
